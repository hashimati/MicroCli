package ${defaultPackage}.controllers

import ${defaultPackage}.domains.${className}
import ${defaultPackage}.utils.Randomizer
import io.micronaut.http.HttpRequest
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.test.extensions.junit5.annotation.MicronautTest
import org.junit.jupiter.api.Test

import jakarta.inject.Inject


@MicronautTest
class ${className}ControllerTest {

    @Inject
    @Client("/api/${entityName}")
    HttpClient client;

    ${className} body;
    @Test
    void save() {
        ${className} ${entityName} = new Randomizer<${className}>(${className}.class).getRandomInstance()
        HttpRequest<${className}> request = HttpRequest.POST("/save", ${entityName})
        this.body = client.toBlocking().retrieve(request, ${className}.class)

        this.body = client.toBlocking().retrieve(request, ${className}.class)
        assert body != null;
    }

    @Test
    void findById() {


        save();
        HttpRequest<${className}> request = HttpRequest.GET("/get?id="+this.body.getId());
        ${className} body = client.toBlocking().retrieve(request, ${className}.class);
        assert body != null
        assert body.getId() == this.body.getId();
    }

    @Test
    void deleteById() {
        save();
        HttpRequest<Boolean> request = HttpRequest.DELETE("/delete/"+this.body.id);

        Boolean body= client.toBlocking().retrieve(request, Boolean.class);

        println body
        assert body.booleanValue()== true;

    }

    @Test
    void findAll() {

        save();
        HttpRequest<Iterable<${className}>> request = HttpRequest.GET("/findAll");
        Iterable<${className}> list = client.toBlocking().retrieve(request, Iterable.class);
        System.out.println(list);
        assert list != null;

    }

    @Test
    void update() {
        save();
        HttpRequest<${className}> request = HttpRequest.PUT("/update", this.body);

        ${className} ${entityName} = client.toBlocking().retrieve(request, ${className}.class);
        assert ${entityName} != null;

    }
}
